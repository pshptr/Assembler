## Сегментная организация памяти

Пусть исполняемый модуль некоторой программы загружен в память компьютера. Команды модуля в заданном порядке считываются в микропроцессор и выполняются. При этом они используют данные, которые выбирают из памяти и регистров микропроцессора.Поскольку для адресации памяти микропроцессор 8086 использует 16-битовые адресные регистры, это обеспечитывает доступ к 2^16 = 65536 байт, в то время как общее адресное пространство составляло 1 мегабайт.

Рассмотрим, как можно адресовать память объемом 1 мегабайт с помощью 16-разрядных регистров микропроцессора. Для этого необходимо разделить всю адресуемую память на сегменты объемом 64 килобайта, причем принято, что каждый сегмент может начинаться только на границе параграфа от начала памяти (параграф - 16 байт). Различные сегменты могут перекрываться или совпадать друг с другом. Начальный адрес каждого сегмента должен храниться в одном из сегментных регистров (CS, DS, SS, ES). Все эти регистры 16-разрядные. Таким образом стартовые адреса будут храниться в одном из сегментов регистров, но без последнего нуля. Эти адреса называются базовыми адресами сегментов.

Для того чтобы получить значения полного физического адреса начала сегмента, к содержимому сегмента содержимого регистра достаточно дописать справа шестнадцатеричный ноль.

Физический адрес некоторого элемента в памяти (порядковый номер первого байта элемента от начала памяти) определяется суммой значения заданного в сегментном регистре со значением, называемым смещением.

Смещение определяет порядковый номер первого байта элемента от начала сегмента и может хранится в одном из следующих регистров микропроцессора:
* IP для кода;
* SI, DI, BX для данных;
* SI, BP для стека.

Суммирование происходит следующим образом: микропроцессор расширяет содержимое сегментного регистра (базовый адрес), добавляя к нему четыре младших нулевых бита, при этом адрес становится 20-битовым (полный адрес сегмента) и прибавляет к младшим 16 битам значение смещения. Полученный 20-битовый результат будет представлять собой физических (абсолютный) адрес памяти.

В языке ассемблера можно использовать так называемые префикс-замены, которые позволяет переопределять сегменты для разных элементов.

Значения смещений в адресных регистрах можно увеличивать или уменьшать, но при этом иметь ввиду, что память имеет кольцевую организацию, т.е., после смещения 0xFFFF следует смещение 0x0000 и наоборот перед 0x0000 следует 0xFFFF.

Как правило, для каждой программы в памяти выделяется несколько сегментов, имеющих свое назначение. Существует три основных типа сегментов: 
* Сегмент кода, который содержит машинные команды и адресуется регистром CS;
* Сегмент данных, который содержит данные, необходимые программе и адресуется регистром DS;
* Сегмент стека, адресуется регистром SS.

## Способы адресации (не сегодня)